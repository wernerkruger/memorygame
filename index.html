<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Number Memory Game</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #222;
        color: #eee;
        display: flex;
        justify-content: center;
        margin-top: 40px;
    }

    #container {
        text-align: center;
    }

    #grid {
        display: grid;
        grid-template-columns: repeat(3, 80px);
        gap: 10px;
        margin: 20px auto;
    }

    .cell {
        width: 80px;
        height: 80px;
        background: #444;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2em;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s;
    }

    .cell:hover {
        background: #555;
    }

    .flash {
        background: yellow !important;
        color: black;
    }

    #message {
        margin-top: 20px;
        font-size: 1.3em;
    }

    #scores {
        margin-top: 10px;
        font-size: 1.1em;
    }

    #start, #reset, #piMode {
        background: #888;
        color: #000;
        font-weight: bold;
        font-size: 1.2em;
    }
</style>
</head>

<body>
<div id="container">
    <h1>Number Memory Game</h1>

    <div id="scores">
        <div>Current Streak: <span id="currentStreak">0</span></div>
        <div>Best Streak: <span id="bestStreak">0</span></div>
    </div>

    <div id="grid"></div>
    <div id="message">Press START or PI to begin</div>
</div>

<script>
// ---------------------------
// SOUND
// ---------------------------
function playBeepForDigit(digit) {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.setValueAtTime(300 + digit * 80, audioCtx.currentTime);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.35);
    osc.stop(audioCtx.currentTime + 0.35);
}

// ---------------------------
// GAME VARIABLES
// ---------------------------
const grid = document.getElementById("grid");
const message = document.getElementById("message");

const currentStreakEl = document.getElementById("currentStreak");
const bestStreakEl = document.getElementById("bestStreak");

let sequence = [];
let userIndex = 0;
let acceptingInput = false;
let currentStreak = 0;
let bestStreak = Number(localStorage.getItem("numberGameHighScore")) || 0;
bestStreakEl.textContent = bestStreak;

let piMode = false;

// π digits (no decimal point)
const PI_DIGITS = "31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819";  
// You can add more if you want; this is 60 digits.

// ---------------------------
// BUILD GRID
// ---------------------------
const digits = [...Array(10).keys()];

digits.forEach(d => {
    const cell = document.createElement("div");
    cell.className = "cell";
    cell.textContent = d;
    cell.dataset.value = d;
    grid.appendChild(cell);
});

// Add START, RESET, and PI buttons
function addButton(id, label) {
    const b = document.createElement("div");
    b.className = "cell";
    b.id = id;
    b.textContent = label;
    grid.appendChild(b);
}
addButton("start", "Start");
addButton("piMode", "PI");
addButton("reset", "Reset");

const allCells = document.querySelectorAll(".cell");

// ---------------------------
// FLASH CELL
// ---------------------------
function flashCell(cell) {
    return new Promise(resolve => {
        cell.classList.add("flash");
        playBeepForDigit(Number(cell.dataset.value));
        setTimeout(() => {
            cell.classList.remove("flash");
            setTimeout(resolve, 150);
        }, 500);
    });
}

// ---------------------------
// PLAY SEQUENCE
// ---------------------------
async function playSequence() {
    acceptingInput = false;
    for (let digit of sequence) {
        const cell = [...allCells].find(c => c.dataset.value == digit);
        await flashCell(cell);
    }
    acceptingInput = true;
    message.textContent = "Now repeat the sequence!";
}

// ---------------------------
// ADD NEXT DIGIT
// ---------------------------
function addDigit() {
    let next;
    if (!piMode) {
        next = Math.floor(Math.random() * 10);
    } else {
        next = Number(PI_DIGITS[sequence.length]);  
        if (isNaN(next)) {
            message.textContent = "You've reached the end of the π digits!";
            acceptingInput = false;
            return;
        }
    }

    sequence.push(next);

    currentStreak = sequence.length - 1;
    currentStreakEl.textContent = currentStreak;

    if (currentStreak > bestStreak) {
        bestStreak = currentStreak;
        bestStreakEl.textContent = bestStreak;
        localStorage.setItem("numberGameHighScore", bestStreak);
    }

    message.textContent = `Sequence length: ${sequence.length}`;
    playSequence();
}

// ---------------------------
// START / PI / RESET
// ---------------------------
function startGame(random=true) {
    piMode = !random;
    sequence = [];
    userIndex = 0;
    currentStreak = 0;
    currentStreakEl.textContent = currentStreak;

    if (piMode) {
        message.textContent = "PI Mode: Memorize the digits of π!";
    } else {
        message.textContent = "Random Mode Started!";
    }

    addDigit();
}

function resetGame() {
    sequence = [];
    userIndex = 0;
    acceptingInput = false;
    currentStreak = 0;
    currentStreakEl.textContent = currentStreak;
    message.textContent = "Game reset. Press START or PI.";
}

// ---------------------------
// USER CLICKS
// ---------------------------
grid.addEventListener("click", (e) => {
    const cell = e.target;
    const val = cell.dataset.value;
    if (!val) return;
    if (!acceptingInput) return;

    playBeepForDigit(Number(val));

    if (Number(val) === sequence[userIndex]) {
        userIndex++;
        if (userIndex === sequence.length) {
            userIndex = 0;
            message.textContent = "Correct! Adding next digit...";
            setTimeout(addDigit, 800);
        }
    } else {
        message.textContent = `Wrong! You reached a streak of ${currentStreak}. Press START or PI to try again.`;
        acceptingInput = false;
    }
});

// Button hooks
document.getElementById("start").onclick = () => startGame(true);
document.getElementById("piMode").onclick = () => startGame(false);
document.getElementById("reset").onclick = () => resetGame();

</script>
</body>
</html>
