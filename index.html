<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Number Memory Game</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #222;
        color: #eee;
        display: flex;
        justify-content: center;
        margin-top: 40px;
    }

    #container {
        text-align: center;
        max-width: 500px;
    }

    #grid {
        display: grid;
        grid-template-columns: repeat(3, 80px);
        gap: 10px;
        margin: 20px auto;
    }

    .cell {
        width: 80px;
        height: 80px;
        background: #444;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2em;
        border-radius: 6px;
        cursor: pointer;
        transition: background 0.2s;
    }

    .cell:hover {
        background: #555;
    }

    .flash {
        background: yellow !important;
        color: black;
    }

    #scores, #leaderboards {
        margin-top: 10px;
        font-size: 1.1em;
    }

    table {
        width: 100%;
        margin-top: 10px;
        border-collapse: collapse;
    }

    td, th {
        border-bottom: 1px solid #555;
        padding: 4px;
    }

    #start, #reset, #piMode {
        background: #888;
        color: #000;
        font-weight: bold;
        font-size: 1.2em;
    }
</style>
</head>

<body>
<div id="container">
    <h1>Number Memory Game</h1>

    <div id="scores">
        Current Streak: <span id="currentStreak">0</span><br>
        Mode: <span id="modeLabel">Random</span>
    </div>

    <div id="grid"></div>
    <div id="message">Press START or PI to begin</div>

    <div id="leaderboards">
        <h2>Top 10 Scores</h2>

        <h3>Random Mode</h3>
        <table id="randomTable"></table>

        <h3>PI Mode</h3>
        <table id="piTable"></table>
    </div>
</div>

<script>
// ---------------------------
// SOUND
// ---------------------------
function playBeepForDigit(digit) {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.frequency.setValueAtTime(300 + digit * 80, ctx.currentTime);
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.35);
    osc.stop(ctx.currentTime + 0.35);
}

// ---------------------------
// GAME STATE
// ---------------------------
const grid = document.getElementById("grid");
const message = document.getElementById("message");
const modeLabel = document.getElementById("modeLabel");

const currentStreakEl = document.getElementById("currentStreak");

let sequence = [];
let userIndex = 0;
let acceptingInput = false;
let currentStreak = 0;
let piMode = false;

// π digits (no decimal)
const PI_DIGITS = "31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819";  
// ---------------------------
// HIGH SCORES (top 10 each mode)
// ---------------------------
function loadScores(key) {
    return JSON.parse(localStorage.getItem(key) || "[]");
}

function saveScores(key, arr) {
    localStorage.setItem(key, JSON.stringify(arr));
}

let randomHighScores = loadScores("randomHighScores");
let piHighScores = loadScores("piHighScores");

// ensure limit 10
function trim10(arr) {
    return arr.sort((a,b)=>b.score-a.score).slice(0,10);
}

// Update leaderboard tables
function renderTables() {
    renderTable("randomTable", randomHighScores);
    renderTable("piTable", piHighScores);
}

function renderTable(id, scores) {
    const t = document.getElementById(id);
    t.innerHTML = "<tr><th>Name</th><th>Score</th></tr>" +
        scores.map(s => `<tr><td>${s.name}</td><td>${s.score}</td></tr>`).join("");
}

renderTables();

// Check if new score qualifies for top10
function checkHighScore(score, mode) {
    const list = mode ? piHighScores : randomHighScores;
    if (list.length < 10) return true;
    return score > list[list.length - 1].score;
}

function addHighScore(score, mode) {
    const key = mode ? "piHighScores" : "randomHighScores";
    const list = mode ? piHighScores : randomHighScores;

    const name = prompt("Congrats! You made the top 10.\nEnter your name:");
    const entry = { name: name || "Anonymous", score };

    list.push(entry);
    const trimmed = trim10(list);

    if (mode) { piHighScores = trimmed; }
    else { randomHighScores = trimmed; }

    saveScores(key, trimmed);
    renderTables();
}

// ---------------------------
// BUILD GRID
// ---------------------------
const digits = [...Array(10).keys()];

digits.forEach(d => {
    const cell = document.createElement("div");
    cell.className = "cell";
    cell.textContent = d;
    cell.dataset.value = d;
    grid.appendChild(cell);
});

// Add buttons
function addButton(id, label) {
    const b = document.createElement("div");
    b.className = "cell";
    b.id = id;
    b.textContent = label;
    grid.appendChild(b);
}

addButton("start", "Start");
addButton("piModeButton", "PI");
addButton("reset", "Reset");

const allCells = document.querySelectorAll(".cell");

// ---------------------------
// FLASH CELL
// ---------------------------
function flashCell(cell) {
    return new Promise(resolve => {
        cell.classList.add("flash");
        playBeepForDigit(Number(cell.dataset.value));
        setTimeout(() => {
            cell.classList.remove("flash");
            setTimeout(resolve, 150);
        }, 500);
    });
}

// ---------------------------
// PLAY SEQUENCE
// ---------------------------
async function playSequence() {
    acceptingInput = false;
    for (let digit of sequence) {
        const cell = [...allCells].find(c => c.dataset.value == digit);
        await flashCell(cell);
    }
    acceptingInput = true;
    message.textContent = "Now repeat the sequence!";
}

// ---------------------------
// ADD NEXT DIGIT
// ---------------------------
function addDigit() {
    let next;
    if (!piMode) {
        next = Math.floor(Math.random() * 10);
    } else {
        next = Number(PI_DIGITS[sequence.length]);
        if (isNaN(next)) {
            message.textContent = "You've reached the end of π digits!";
            acceptingInput = false;
            return;
        }
    }

    sequence.push(next);
    currentStreak = sequence.length - 1;
    currentStreakEl.textContent = currentStreak;

    playSequence();
}

// ---------------------------
// START / RESET
// ---------------------------
function startGame(random=true) {
    piMode = !random;
    modeLabel.textContent = piMode ? "PI" : "Random";

    sequence = [];
    userIndex = 0;
    currentStreak = 0;
    currentStreakEl.textContent = currentStreak;

    if (piMode) {
        message.textContent = "PI Mode: Memorize π digits!";
    } else {
        message.textContent = "Random Mode Started!";
    }

    addDigit();
}

function resetGame() {
    sequence = [];
    userIndex = 0;
    acceptingInput = false;
    currentStreak = 0;
    currentStreakEl.textContent = currentStreak;
    message.textContent = "Game reset. Press START or PI.";
}

// ---------------------------
// USER CLICK INPUT
// ---------------------------
grid.addEventListener("click", (e) => {
    const cell = e.target;
    const val = cell.dataset.value;
    if (!val) return;
    if (!acceptingInput) return;

    playBeepForDigit(Number(val));

    if (Number(val) === sequence[userIndex]) {
        userIndex++;

        if (userIndex === sequence.length) {
            userIndex = 0;
            message.textContent = "Correct! Adding next digit...";
            setTimeout(addDigit, 800);
        }
    } else {
        // failure
        acceptingInput = false;
        message.textContent = `Wrong! Final streak: ${currentStreak}.`;

        // check for high score
        if (checkHighScore(currentStreak, piMode)) {
            addHighScore(currentStreak, piMode);
        }
    }
});

// ---------------------------
// BUTTON HANDLERS
// ---------------------------
document.getElementById("start").onclick = () => startGame(true);
document.getElementById("piModeButton").onclick = () => startGame(false);
document.getElementById("reset").onclick = () => resetGame();

</script>
</body>
</html>
